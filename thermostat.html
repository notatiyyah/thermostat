<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Thermostat</title>
    <script src="src/Thermostat.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="src/style.css">
  </head>
  <script>
    $(document).ready(function(){

      function updatePowerSaving() {
        $("#power_indicator").css("background-color", `${thermostat.isPowerSavingOn() ? "green" : "red" }` ); 
        // sets indicator to red if power saving off and green if on
      }

      function updateTemp(){
        $("#temp_view").val(thermostat.temp())
        $("#temp").html(thermostat.temp())
        // Sets display temp to the temperature from the thermostat object
      }

      function updateUsage(){
        var colours = [
          { usageColour: "green",
          thermColour: "#f0f8ff", // blue
          borderCol: "#dcefff"},
          { usageColour: "orange",
          thermColour: "#f0fff7", // green
          borderCol: "#dcffed"},
          { usageColour: "red",
          thermColour: "#fff0f8", // red
          borderCol: "#ffdcef"}
        ];
        var option = 1
        switch (thermostat.usage()){
          case "low-usage":
              option = 0;
            break;
          case "medium-usage":
            option = 1;
            break;
          case "high-usage":
            option = 2;
            break;
        };
        $("#usage_indicator").css("background-color", `${colours[option].usageColour}`);
        $("#thermostat").css("background-color", `${colours[option].thermColour}`);
        $("#thermostat").css("border-color", `${colours[option].borderCol}`);
      }

      function updateAll() {
        updateTemp();
        updatePowerSaving();
        updateUsage();
      }

      function getWeather(city){
        var apiToken = "8d2b22130fc8aff659d254bf07cd5349";
        $.get(`http://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiToken}&units=metric`, function(data){
          $("#weather").html(data.weather[0].main);
          $("#weatherTemp").html(data.main.temp);
        });
      }

      function fixCircle(){
        $("#thermostat").width($("#thermostat").height());
      }

      // ON LOAD :
      var thermostat = new Thermostat();
      // Created thermostat object to use
      updateAll();
      getWeather("London")
      fixCircle();
    
      // BUTTON FUNCTIONS

      $("#ps").click(function(){
        thermostat.togglePowerSaving();
      });

      $("#up.temp").click(function(){
        thermostat.increaseBy(1);
      });

      $("#down.temp").click(function(){
        thermostat.decreaseBy(1);
      });

      $("#reset").click(function(){
        thermostat.reset();
      });

      $(":button").click(function(){ updateAll(); });
      // Update all after any button is pressed

    });

  </script>
  <body>
    <div id="main">
      <div class="content" id='thermostat'>
        <h1>Thermostat</h1>
        <p>Current weather: <span id="weather"></span>, <span id="weatherTemp"></span>°C</p>
        <label id="current_temp" for="temp_view">House temperature: <span id="temp"></span>°C</label><br/>
        <meter id="temp_view"
              min="10" max="32"
              low="18" high="26" optimum="20"
              value="20">
        </meter><br/>
        <div id="temp_controls">
          <button class= "temp" id="down">-</button>
          <button class="temp" id="up">+</button>
        </div>
        <button class="btn btn-dark" id="reset">Reset</button>
      </div>
    </div>
    <div id="sidebar">
      <div class="content">
        <div class="indicator">
          <label for="usage_indicator">Usage:</label>
          <div class="led" id="usage_indicator"></div>
        </div>
        <div class="indicator">
          <label for="power_indicator">Power Saving mode: </label>
          <div class="led" id="power_indicator"></div>
        </div>
        <button id="ps">Toggle</button>
      </div>
    </div>
  </body>
</html>
